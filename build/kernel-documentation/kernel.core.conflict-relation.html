<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>kernel.core.conflict-relation documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Kernel</span> <span class="project-version">SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>kernel</span></div></div></li><li class="depth-2 branch"><a href="kernel.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-2"><a href="kernel.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="kernel.core.causal-dag.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal-dag</span></div></a></li><li class="depth-3 branch"><a href="kernel.core.compound-operation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compound-operation</span></div></a></li><li class="depth-3 branch"><a href="kernel.core.conflict-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>conflict-cache</span></div></a></li><li class="depth-3 branch current"><a href="kernel.core.conflict-relation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>conflict-relation</span></div></a></li><li class="depth-3 branch"><a href="kernel.core.feature-model.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>feature-model</span></div></a></li><li class="depth-3 branch"><a href="kernel.core.garbage-collector.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>garbage-collector</span></div></a></li><li class="depth-3 branch"><a href="kernel.core.history-buffer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>history-buffer</span></div></a></li><li class="depth-3 branch"><a href="kernel.core.message.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>message</span></div></a></li><li class="depth-3 branch"><a href="kernel.core.movic.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>movic</span></div></a></li><li class="depth-3 branch"><a href="kernel.core.primitive-operation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>primitive-operation</span></div></a></li><li class="depth-3 branch"><a href="kernel.core.topological-sort.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>topological-sort</span></div></a></li><li class="depth-3"><a href="kernel.core.vector-clock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>vector-clock</span></div></a></li><li class="depth-2 branch"><a href="kernel.helpers.html"><div class="inner"><span class="tree" style="top: -393px;"><span class="top" style="height: 402px;"></span><span class="bottom"></span></span><span>helpers</span></div></a></li><li class="depth-2"><a href="kernel.shell.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shell</span></div></a></li><li class="depth-3 branch"><a href="kernel.shell.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-3 branch"><a href="kernel.shell.context.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>context</span></div></a></li><li class="depth-3 branch"><a href="kernel.shell.server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>server</span></div></a></li><li class="depth-3"><a href="kernel.shell.site.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>site</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="kernel.core.conflict-relation.html#var-cached-conflicting*.3F"><div class="inner"><span>cached-conflicting*?</span></div></a></li><li class="depth-1"><a href="kernel.core.conflict-relation.html#var-CO-conflict-reducer"><div class="inner"><span>CO-conflict-reducer</span></div></a></li><li class="depth-1"><a href="kernel.core.conflict-relation.html#var-CO-conflicting.3F"><div class="inner"><span>CO-conflicting?</span></div></a></li><li class="depth-1"><a href="kernel.core.conflict-relation.html#var-CO-semantically-conflicting.3F"><div class="inner"><span>CO-semantically-conflicting?</span></div></a></li><li class="depth-1"><a href="kernel.core.conflict-relation.html#var-CO-syntactically-conflicting.3F"><div class="inner"><span>CO-syntactically-conflicting?</span></div></a></li><li class="depth-1"><a href="kernel.core.conflict-relation.html#var-compatible.3F"><div class="inner"><span>compatible?</span></div></a></li><li class="depth-1"><a href="kernel.core.conflict-relation.html#var-conflicting.3F"><div class="inner"><span>conflicting?</span></div></a></li><li class="depth-1"><a href="kernel.core.conflict-relation.html#var-uncached-conflicting*.3F"><div class="inner"><span>uncached-conflicting*?</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">kernel.core.conflict-relation</h1><div class="doc"><div class="markdown"><p>Conflict relation used by the MOVIC algorithm (<a href="kernel.core.movic.html">kernel.core.movic</a> to detect conflicts between competing operations.</p>
<p>The default conflict relation of the MOVIC algorithm is not suitable for feature modeling as it does not consider the particular structure and rules for consistent feature models. Instead, we introduce two new conflict relations: <a href="kernel.core.conflict-relation.html#var-CO-conflicting.3F">CO-conflicting?</a> and <a href="kernel.core.conflict-relation.html#var-conflicting.3F">conflicting?</a>.</p>
<p>CO-conflicting? checks whether two compound operations are conflicting, provided that all operations leading up to (causally preceding) these operations did not trigger a conflict. Primitive operations in a compound operation are then subsequently applied to the feature model and a number of consistency properties are checked. If all pass, the operations are considered compatible, else a conflict is declared.</p>
<p>conflicting? ensures the precondition of CO-conflicting? that causally preceding operations have to be compatible and provides a feature model for applying primitive operation.</p>
<p>The conflict detection results are stored in a conflict cache to improve performance (because conflicting? is implemented recursively).</p></div></div><div class="public anchor" id="var-cached-conflicting*.3F"><h3>cached-conflicting*?</h3><div class="usage"><code>(cached-conflicting*? CO-a CO-b CDAG HB base-FM CC&amp;)</code></div><div class="doc"><div class="markdown"><p>Mutually recurses with <a href="kernel.core.conflict-relation.html#var-uncached-conflicting*.3F">uncached-conflicting*?</a> to cache conflict detection results.</p>
<p>The CDAG, HB, base-FM and CC&amp; arguments are passed down as context. This function only uses (and modifies) the conflict cache.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/f91255d5f389ba8762a8746e260ff024e201ff3c/kernel/src/kernel/core/conflict_relation.cljc#L243">view source</a></div></div><div class="public anchor" id="var-CO-conflict-reducer"><h3>CO-conflict-reducer</h3><div class="usage"><code>(CO-conflict-reducer base-FM+preceding-CO-y base-FM+preceding-CO-y+CO-y)</code></div><div class="doc"><div class="markdown"><p>For each primitive operation from one compound operation CO-x, checks whether applying it would compromise feature model consistency assuming that another compound operation CO-y has already been applied.</p>
<p>Some rules access to the feature model (e.g., children implicitly targeted by an operation), which has to be obtained by actually applying the operations to intermediate feature models. This is potentially slow, although this is only required if operations are eligible for conflict, i.e. concurrent, which is not the most common case.</p>
<p>Multiple rules are checked to guarantee basic feature model consistency (called syntactic consistency):</p>
<ul>
  <li>The <em>no-overwrites rule</em> flags two updates that target the same feature/constraint attribute as conflict.</li>
  <li>The <em>no-cycles rule</em> flags any two updates as conflict that introduce a cycle to the feature tree.</li>
  <li>The <em>no-graveyarded rule</em> flags an update and a remove (which is in turn a special update)  as conflict when the update targets the removed feature/constraint or an implicit child of the removed feature.  A special case must be considered, namely un-removing a removed or created feature/constraint  (setting the parent from :graveyard to something else).</li>
  <li>The <em>group-children rule</em> flags two updates as conflict if one changes a feature group to :or or  :alternative, and the other sets a child of said feature to mandatory or optional.</li>
  <li>The <em>assert-no-child-added rule</em> flags two updates as conflict if one asserts that no feature  children may be added by the other, but the other adds feature children nonetheless  (see <a href="kernel.core.compound-operation.html#var-remove-feature">kernel.core.compound-operation/remove-feature</a>).</li>
</ul>
<p>All rules included here are checked in a short-circuiting way, so they may build upon each other, and they should return true if a conflict is present. These rules assume that CO-y has been applied and everything up to, but excluding PO-x.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/f91255d5f389ba8762a8746e260ff024e201ff3c/kernel/src/kernel/core/conflict_relation.cljc#L31">view source</a></div></div><div class="public anchor" id="var-CO-conflicting.3F"><h3>CO-conflicting?</h3><div class="usage"><code>(CO-conflicting? CO-a CO-b CDAG HB base-FM)</code></div><div class="doc"><div class="markdown"><p>Determines whether two compound operations are in conflict, assuming that no causally preceding operations were in conflict.</p>
<p>First, it is checked whether subsequently applying CO-a (assuming CO-b has already been applied) yields a conflict. The same is then checked the other way by subsequently applying CO-b (assuming CO-a has already been applied). Finally, any additional semantic rules are checked.</p>
<p>The CDAG, HB and base-FM arguments are passed down as context for <a href="kernel.core.conflict-relation.html#var-CO-syntactically-conflicting.3F">CO-syntactically-conflicting?</a>.</p>
<p><strong>OPTIMIZE</strong>: Remove the assertion.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/f91255d5f389ba8762a8746e260ff024e201ff3c/kernel/src/kernel/core/conflict_relation.cljc#L165">view source</a></div></div><div class="public anchor" id="var-CO-semantically-conflicting.3F"><h3>CO-semantically-conflicting?</h3><div class="usage"><code>(CO-semantically-conflicting? FM+preceding-CO-a+CO-a+preceding-CO-b+CO-b)</code></div><div class="doc"><div class="markdown"><p>Determines whether two compound operations are in semantic conflict, according to the rules defined in <a href="kernel.core.feature-model.html#var-semantic-rules">kernel.core.feature-model/semantic-rules</a>.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/f91255d5f389ba8762a8746e260ff024e201ff3c/kernel/src/kernel/core/conflict_relation.cljc#L156">view source</a></div></div><div class="public anchor" id="var-CO-syntactically-conflicting.3F"><h3>CO-syntactically-conflicting?</h3><div class="usage"><code>(CO-syntactically-conflicting? CO-x CO-y CDAG HB base-FM arg continue)</code></div><div class="doc"><div class="markdown"><p>Determines whether two compound operations are in syntactic conflict, according to the rules defined in <a href="kernel.core.conflict-relation.html#var-CO-conflict-reducer">CO-conflict-reducer</a>.</p>
<p>For that, produces a feature model suitable for subsequently applying CO-x. The feature models are well-defined, because the CDAG has all information regarding CP-x and CP-y across all sites (due to causality preservation), and we may simply assume base-FM to represent the CDAG garbage collected up to this point (so the base-FM can be seen as an implementation detail of the CDAG, i.e., if there was no base-FM, we would just use the entire CDAG on an empty initial feature model, which is clearly correct).</p>
<p>First applies <code>(set/intersection CP-x CP-y)</code> to <code>base-FM</code>, then <code>(set/difference CP-y (set/intersection CP-x CP-y))</code>. Because the intermediate result is not needed, their union can directly be applied, which is CP-y, yielding <code>base-FM+preceding-CO-y</code>.</p>
<p>Next, CO-y is applied, yielding <code>base-FM+preceding-CO-y+CO-y</code>. Both of these are required to ensure CO-conflict-reducerâ€™s assert-no-child-added rule.</p>
<p>Next, <code>(set/difference CP-x (set/intersection CP-x CP-y))</code> is applied, which simplifies to <code>(set/difference CP-x CP-y)</code>, yielding <code>base-FM+preceding-CO-y+CO-y+preceding-CO-x</code>.</p>
<p>This feature model is fed into CO-conflict-reducer which subsequently applies all primitive operations contained in CO-x to produce a final <code>base-FM+preceding-CO-y+CO-y+preceding-CO-x+CO-x</code>.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/f91255d5f389ba8762a8746e260ff024e201ff3c/kernel/src/kernel/core/conflict_relation.cljc#L111">view source</a></div></div><div class="public anchor" id="var-compatible.3F"><h3>compatible?</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Determines whether two operations are compatible with each other. As it is derived from the conflict relation, it is reflexive and symmetric, but not transitive. This kind of relation is also known as compatibility relation. This guarantees convergence, but it is only a necessary, not sufficient condition for intention preservation (Xue et al., 2003).</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/f91255d5f389ba8762a8746e260ff024e201ff3c/kernel/src/kernel/core/conflict_relation.cljc#L271">view source</a></div></div><div class="public anchor" id="var-conflicting.3F"><h3>conflicting?</h3><div class="usage"><code>(conflicting? CO-a CO-b CDAG HB base-FM CC&amp;)</code></div><div class="doc"><div class="markdown"><p>Determines whether two compound operations are in conflict with each other. This may only be the case for concurrent operations, as causally ordered operations can be guaranteed compatible at generation time. This relation should be irreflexive and symmetric. It is not generally transitive. When called with a newly arrived operation, it should be the second one to allow for optimization.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/f91255d5f389ba8762a8746e260ff024e201ff3c/kernel/src/kernel/core/conflict_relation.cljc#L260">view source</a></div></div><div class="public anchor" id="var-uncached-conflicting*.3F"><h3>uncached-conflicting*?</h3><div class="usage"><code>(uncached-conflicting*? CO-a CO-b CDAG HB base-FM CC&amp;)</code></div><div class="doc"><div class="markdown"><p>Determines whether two compound operations are in conflict. If they are, causally succeeding operations are also in conflict (a transitivity of sorts).</p>
<p>As this relation is only used by MOVIC when a new operation arrives, we may assume that if one of CO-a or CO-b is the new operation, it is CO-b (this does not impact the result, it is only an optimization).</p>
<p>The CDAG, HB, base-FM and CC&amp; arguments are passed down as context. This function only uses CDAG to obtain CIPs of CO-a and CO-b.</p>
<p>Algorithm pseudocode (CACHE is only a performance optimization and not essential):</p>
<pre><code>conflicting?(CO-a, CO-b): (assuming that if a new operation is supplied, it is CO-b)
CACHE: if CO-a, CO-b are known, return whether #{CO-a, CO-b} is in the cache; else continue
if CO-a not concurrent CO-b, or CO-a == CO-b: return false (respect causal order and irreflexivity)
foreach CIP(CO-a) and CIP(CO-b), if (conflicting? CIP(CO-a) CIP(CO-b)), goto return_true
foreach CIP(CO-b), if (conflicting? CO-a CIP(CO-b)), goto return_true (this one goes first, as we may hit the cache)
foreach CIP(CO-a), if (conflicting? CIP(CO-a) CO-b), goto return_true (from here on, the cache is not hittable)
if (CO-conflicting? CO-a CO-b), goto return_true
else return false
return_true:
CACHE: add #{CO-a, CO-b} to the cache
return true
</code></pre>
<p>For better separation of concerns, conflicting? is split up over two functions, uncached-conflicting*? and <a href="kernel.core.conflict-relation.html#var-cached-conflicting*.3F">cached-conflicting*?</a>.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/f91255d5f389ba8762a8746e260ff024e201ff3c/kernel/src/kernel/core/conflict_relation.cljc#L197">view source</a></div></div></div></body></html>