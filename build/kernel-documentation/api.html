<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>api documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Kernel</span> <span class="project-version">SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 branch current"><a href="api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-1"><a href="core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="core.causal-dag.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal-dag</span></div></a></li><li class="depth-2 branch"><a href="core.compound-operation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compound-operation</span></div></a></li><li class="depth-2 branch"><a href="core.conflict-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>conflict-cache</span></div></a></li><li class="depth-2 branch"><a href="core.conflict-relation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>conflict-relation</span></div></a></li><li class="depth-2 branch"><a href="core.feature-model.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>feature-model</span></div></a></li><li class="depth-2 branch"><a href="core.garbage-collector.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>garbage-collector</span></div></a></li><li class="depth-2 branch"><a href="core.history-buffer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>history-buffer</span></div></a></li><li class="depth-2 branch"><a href="core.message.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>message</span></div></a></li><li class="depth-2 branch"><a href="core.movic.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>movic</span></div></a></li><li class="depth-2 branch"><a href="core.primitive-operation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>primitive-operation</span></div></a></li><li class="depth-2 branch"><a href="core.topological-sort.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>topological-sort</span></div></a></li><li class="depth-2"><a href="core.vector-clock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>vector-clock</span></div></a></li><li class="depth-1 branch"><a href="helpers.html"><div class="inner"><span class="tree" style="top: -393px;"><span class="top" style="height: 402px;"></span><span class="bottom"></span></span><span>helpers</span></div></a></li><li class="depth-1"><a href="shell.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shell</span></div></a></li><li class="depth-2 branch"><a href="shell.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="shell.context.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>context</span></div></a></li><li class="depth-2 branch"><a href="shell.server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>server</span></div></a></li><li class="depth-2"><a href="shell.site.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>site</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="api.html#var-client-GC.21"><div class="inner"><span>client-GC!</span></div></a></li><li class="depth-1"><a href="api.html#var-client-generate-heartbeat.21"><div class="inner"><span>client-generate-heartbeat!</span></div></a></li><li class="depth-1"><a href="api.html#var-client-generate-inverse-operation.21"><div class="inner"><span>client-generate-inverse-operation!</span></div></a></li><li class="depth-1"><a href="api.html#var-client-generate-operation.21"><div class="inner"><span>client-generate-operation!</span></div></a></li><li class="depth-1"><a href="api.html#var-client-initialize.21"><div class="inner"><span>client-initialize!</span></div></a></li><li class="depth-1"><a href="api.html#var-client-receive-message.21"><div class="inner"><span>client-receive-message!</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-compose"><div class="inner"><span>operation-compose</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-create-constraint.21"><div class="inner"><span>operation-create-constraint!</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-create-feature-above.21"><div class="inner"><span>operation-create-feature-above!</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-create-feature-below.21"><div class="inner"><span>operation-create-feature-below!</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-move-feature-subtree.21"><div class="inner"><span>operation-move-feature-subtree!</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-remove-constraint.21"><div class="inner"><span>operation-remove-constraint!</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-remove-feature.21"><div class="inner"><span>operation-remove-feature!</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-remove-feature-subtree.21"><div class="inner"><span>operation-remove-feature-subtree!</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-set-constraint.21"><div class="inner"><span>operation-set-constraint!</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-set-feature-group-type.21"><div class="inner"><span>operation-set-feature-group-type!</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-set-feature-optional.3F.21"><div class="inner"><span>operation-set-feature-optional?!</span></div></a></li><li class="depth-1"><a href="api.html#var-operation-set-feature-property.21"><div class="inner"><span>operation-set-feature-property!</span></div></a></li><li class="depth-1"><a href="api.html#var-server-forward-message.21"><div class="inner"><span>server-forward-message!</span></div></a></li><li class="depth-1"><a href="api.html#var-server-GC.21"><div class="inner"><span>server-GC!</span></div></a></li><li class="depth-1"><a href="api.html#var-server-generate-heartbeat.21"><div class="inner"><span>server-generate-heartbeat!</span></div></a></li><li class="depth-1"><a href="api.html#var-server-initialize.21"><div class="inner"><span>server-initialize!</span></div></a></li><li class="depth-1"><a href="api.html#var-server-site-joined.21"><div class="inner"><span>server-site-joined!</span></div></a></li><li class="depth-1"><a href="api.html#var-server-site-left.21"><div class="inner"><span>server-site-left!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">api</h1><div class="doc"><div class="markdown"><p>API of the kernel.</p>
<p>This API is exposed to consumers (i.e., client and server sites). Most details of the kernel’s data structures are encapsulated and hidden from the consumer.</p>
<p>Notation used in this documentation:</p>
<ul>
  <li><strong>TODO</strong> marks missing features</li>
  <li><strong>OPTIMIZE</strong> marks possible optimizations</li>
  <li><code>&amp;</code> at the end of a variable denotes that it is passed as an atom</li>
  <li><code>_</code> at the beginning of a function name avoids name clashes with Clojure built-ins</li>
  <li><code>!</code> at the end of a function name signifies that it reads or mutates the global context</li>
</ul>
<p>Below, we describe the client, server and operations API. Some general remarks:</p>
<ul>
  <li>Note that unless otherwise specified, all calls to the API must be atomic  (not interrupted) and from a single thread, as no synchronization is done.</li>
  <li>Further, every action specified must be done as soon as possible (e.g.,  right after a user left, the leave message has to be propagated), before  any other API functions are called.  In particular, while changes are still being reflected in the user interface,  no API calls are allowed.</li>
  <li>Unless otherwise specified, <em>periodically</em> and <em>for a while</em> can refer to  arbitrary periods of time, although it would be reasonable to use the same  time periods at all sites.</li>
  <li>The system is considered frozen whenever <a href="api.html#var-client-receive-message.21">client-receive-message!</a> reports  conflicts. The system is only un-frozen when all conflicts are resolved.</li>
  <li>When a client wants to leave, no special API call is necessary.  It can simply discard all its metadata and notify the server  that it is leaving.  <strong>TODO</strong>: Right now, no timeout for leaving is considered. In other words,  a site can not join again using the same site identifier and context once  left, and it must register as a new site (no short-time offline editing).</li>
  <li>The server does not generate messages itself (apart from occasional  explicit heartbeats).</li>
  <li>For more information on the individual operations, refer to  <a href="core.compound-operation.html">core.compound-operation</a>.</li>
</ul></div></div><div class="public anchor" id="var-client-GC.21"><h3>client-GC!</h3><div class="usage"><code>(client-GC!)</code></div><div class="doc"><div class="markdown"><p>Periodically (and when no other API calls are in progress and the system is not frozen), the client must call client-GC!.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L89">view source</a></div></div><div class="public anchor" id="var-client-generate-heartbeat.21"><h3>client-generate-heartbeat!</h3><div class="usage"><code>(client-generate-heartbeat!)</code></div><div class="doc"><div class="markdown"><p>If no operations have been generated for a while (and when no other API calls are in progress and the system is not frozen), the client must call client-generate-heartbeat! and send the resulting message to the server. This is to ensure smooth garbage collection.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L71">view source</a></div></div><div class="public anchor" id="var-client-generate-inverse-operation.21"><h3>client-generate-inverse-operation!</h3><div class="usage"><code>(client-generate-inverse-operation!)</code></div><div class="doc"><div class="markdown"><p><strong>TODO</strong>: Generate inverse operations.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L66">view source</a></div></div><div class="public anchor" id="var-client-generate-operation.21"><h3>client-generate-operation!</h3><div class="usage"><code>(client-generate-operation! PO-sequence)</code></div><div class="doc"><div class="markdown"><p>At any time the system is not frozen, the client may call client-generate-operation! with a valid PO sequence (see operations API) to generate and immediately apply a new operation. <strong>TODO</strong>: Right now, the PO sequence is <em>not</em> sanity-checked, so the client is responsible to respect basic consistency rules (e.g., only submit operations that make sense on the current feature model). client-generate-operation! returns a feature model that the client may consume. It also returns an operation message that the client must send to the server.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L53">view source</a></div></div><div class="public anchor" id="var-client-initialize.21"><h3>client-initialize!</h3><div class="usage"><code>(client-initialize! site-ID context)</code></div><div class="doc"><div class="markdown"><p>When a client first enters the system, it announces itself at the server. The server assigns it a site identifier and an initial context, which the client must call client-initialize! with.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L46">view source</a></div></div><div class="public anchor" id="var-client-receive-message.21"><h3>client-receive-message!</h3><div class="usage"><code>(client-receive-message! message)</code></div><div class="doc"><div class="markdown"><p>When a message arrives from the server, the client must call client-receive-message! with the received message. The call returns either a new feature model that may be consumed by the client, or <strong>TODO</strong> information about how emerged conflicts may be resolved. <strong>TODO</strong>: When a conflict occurs, before un-freezing the system, all conflicting operations have to be completely purged from the system.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L79">view source</a></div></div><div class="public anchor" id="var-operation-compose"><h3>operation-compose</h3><div class="usage"><code>(operation-compose &amp; PO-sequences)</code></div><div class="doc"><div class="markdown"><p>Composes multiple compound operations into one compound operation.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L151">view source</a></div></div><div class="public anchor" id="var-operation-create-constraint.21"><h3>operation-create-constraint!</h3><div class="usage"><code>(operation-create-constraint! formula)</code></div><div class="doc"><div class="markdown"><p>Creates a constraint and initializes it with a given propositional formula.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L196">view source</a></div></div><div class="public anchor" id="var-operation-create-feature-above.21"><h3>operation-create-feature-above!</h3><div class="usage"><code>(operation-create-feature-above! &amp; IDs)</code></div><div class="doc"><div class="markdown"><p>Creates a feature above a set of sibling features.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L161">view source</a></div></div><div class="public anchor" id="var-operation-create-feature-below.21"><h3>operation-create-feature-below!</h3><div class="usage"><code>(operation-create-feature-below! parent-ID)</code></div><div class="doc"><div class="markdown"><p>Creates a feature below another feature.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L156">view source</a></div></div><div class="public anchor" id="var-operation-move-feature-subtree.21"><h3>operation-move-feature-subtree!</h3><div class="usage"><code>(operation-move-feature-subtree! ID parent-ID)</code></div><div class="doc"><div class="markdown"><p>Moves an entire feature subtree rooted at a feature below another feature.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L171">view source</a></div></div><div class="public anchor" id="var-operation-remove-constraint.21"><h3>operation-remove-constraint!</h3><div class="usage"><code>(operation-remove-constraint! ID)</code></div><div class="doc"><div class="markdown"><p>Removes a constraint.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L206">view source</a></div></div><div class="public anchor" id="var-operation-remove-feature.21"><h3>operation-remove-feature!</h3><div class="usage"><code>(operation-remove-feature! ID)</code></div><div class="doc"><div class="markdown"><p>Removes a single feature.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L176">view source</a></div></div><div class="public anchor" id="var-operation-remove-feature-subtree.21"><h3>operation-remove-feature-subtree!</h3><div class="usage"><code>(operation-remove-feature-subtree! ID)</code></div><div class="doc"><div class="markdown"><p>Removes an entire feature subtree rooted at a feature.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L166">view source</a></div></div><div class="public anchor" id="var-operation-set-constraint.21"><h3>operation-set-constraint!</h3><div class="usage"><code>(operation-set-constraint! ID formula)</code></div><div class="doc"><div class="markdown"><p>Sets the propositional formula of a constraint.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L201">view source</a></div></div><div class="public anchor" id="var-operation-set-feature-group-type.21"><h3>operation-set-feature-group-type!</h3><div class="usage"><code>(operation-set-feature-group-type! ID group-type)</code></div><div class="doc"><div class="markdown"><p>Sets the group type attribute of a feature.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L186">view source</a></div></div><div class="public anchor" id="var-operation-set-feature-optional.3F.21"><h3>operation-set-feature-optional?!</h3><div class="usage"><code>(operation-set-feature-optional?! ID optional?)</code></div><div class="doc"><div class="markdown"><p>Sets the optional attribute of a feature.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L181">view source</a></div></div><div class="public anchor" id="var-operation-set-feature-property.21"><h3>operation-set-feature-property!</h3><div class="usage"><code>(operation-set-feature-property! ID property value)</code></div><div class="doc"><div class="markdown"><p>Sets some additional property of a feature.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L191">view source</a></div></div><div class="public anchor" id="var-server-forward-message.21"><h3>server-forward-message!</h3><div class="usage"><code>(server-forward-message! message)</code></div><div class="doc"><div class="markdown"><p>After receiving a message from a client, the server must call server-forward-message! with the received message. The returned message is then forwarded to all sites but the original site.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L111">view source</a></div></div><div class="public anchor" id="var-server-GC.21"><h3>server-GC!</h3><div class="usage"><code>(server-GC!)</code></div><div class="doc"><div class="markdown"><p>Periodically (and when no other API calls are in progress and the system is not frozen), the server must call server-GC!.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L143">view source</a></div></div><div class="public anchor" id="var-server-generate-heartbeat.21"><h3>server-generate-heartbeat!</h3><div class="usage"><code>(server-generate-heartbeat!)</code></div><div class="doc"><div class="markdown"><p>If the server has not forwarded any operations for a while (and when no other API calls are in progress and the system is not frozen), the server must call server-generate-heartbeat! and send the resulting message to all client sites. This may happen for example when only one client site is connected.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L103">view source</a></div></div><div class="public anchor" id="var-server-initialize.21"><h3>server-initialize!</h3><div class="usage"><code>(server-initialize! initial-FM)</code></div><div class="doc"><div class="markdown"><p>When a client first enters the system and requests to edit a given feature model, the server must call server-initialize! with said feature model.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L97">view source</a></div></div><div class="public anchor" id="var-server-site-joined.21"><h3>server-site-joined!</h3><div class="usage"><code>(server-site-joined! site-ID)</code></div><div class="doc"><div class="markdown"><p>Whenever a new site requests to join, the server must call server-site-joined! and send the returned initial context to the site. It also has to forward the returned heartbeat message to all other sites immediately. The new site’s identifier may be chosen by the client or server site, as long as it is unique. <strong>OPTIMIZE</strong>: The conflict cache and feature model may be omitted from the initial context to save network bandwidth, as they can be produced from the other data structures. However, this imposes additional time complexity for the newly joined site, so for now we just transmit everything.</p>
<p>The heartbeat message is generated because directly after the join, the server has to notify all other sites about the new site. This may be done by blocking the server until the new site sends its first heartbeat, but it is more efficient to generate this heartbeat message directly at the server (which is equivalent) and forward it everyone else immediately.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L118">view source</a></div></div><div class="public anchor" id="var-server-site-left.21"><h3>server-site-left!</h3><div class="usage"><code>(server-site-left! site-ID)</code></div><div class="doc"><div class="markdown"><p>When a site leaves, the server must call server-site-left! and forward the returned leave message to all other sites immediately.</p></div></div><div class="src-link"><a href="https://github.com/ekuiter/variED/blob/31d5f3cd4b775da7bf9ec9ac58079d039e14a0e8/kernel/src/api.clj#L137">view source</a></div></div></div></body></html>