plugins {
    id 'com.moowork.node' version '1.2.0'
}

node {
    download = true
    version = '8.11.4'
}

yarn.mustRunAfter 'clean'
tasks.getByPath(':server:transpileCommon').mustRunAfter ':client:yarn'
yarn_build.mustRunAfter ':server:transpileCommon'

task build {
    dependsOn 'clean', ':server:transpileCommon', ':kernel:buildClient', 'yarn', 'yarn_build'
    doLast {
        copy {
            from 'build'
            into '../server/src/main/webapp'
        }
    }
}

task run(dependsOn: 'yarn_start')
task check(dependsOn: 'yarn_test')

task clean {
    doLast {
        delete 'build'
        delete fileTree(dir: '../server/src/main/webapp', exclude: 'WEB-INF')
    }
}