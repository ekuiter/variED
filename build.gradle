task build {
    dependsOn ':clean'
    dependsOn ':kernel:clean'
    dependsOn ':client:clean'
    dependsOn ':server:clean'
    dependsOn ':kernel:build'
    dependsOn ':client:build'
    dependsOn ':server:build'
    doLast() {
        copy {
            from 'server/build/libs'
            into 'build'
        }
    }
}

tasks.getByPath(':kernel:clean').mustRunAfter ':clean'
tasks.getByPath(':client:clean').mustRunAfter ':kernel:clean'
tasks.getByPath(':server:clean').mustRunAfter ':client:clean'
tasks.getByPath(':kernel:build').mustRunAfter ':server:clean'
tasks.getByPath(':client:build').mustRunAfter ':kernel:build'
tasks.getByPath(':server:build').mustRunAfter ':client:build'

task stage(dependsOn: 'build')

task clean {
    doLast {
        delete 'build'
    }
}