task _buildServer(type: Exec) {
    if (org.gradle.internal.os.OperatingSystem.current().isWindows()) {
        commandLine 'cmd', '/c', 'lein.bat', 'uberjar'
    } else {
        commandLine 'bash', 'lein', 'uberjar'
    }
}

task buildClient(type: Exec) {
    if (org.gradle.internal.os.OperatingSystem.current().isWindows()) {
        commandLine 'cmd', '/c', 'lein.bat', 'with-profile', 'client', 'cljsbuild', 'once'
    } else {
        commandLine 'bash', 'lein', 'with-profile', 'client', 'cljsbuild', 'once'
    }
}

task check(type: Exec) {
    if (org.gradle.internal.os.OperatingSystem.current().isWindows()) {
        commandLine 'cmd', '/c', 'lein.bat', 'test'
    } else {
        commandLine 'bash', 'lein', 'test'
    }
}

task doc(type: Exec) {
    if (org.gradle.internal.os.OperatingSystem.current().isWindows()) {
        commandLine 'cmd', '/c', 'lein.bat', 'codox'
    } else {
        commandLine 'bash', 'lein', 'codox'
    }
}

task buildServer {
    dependsOn '_buildServer'
    doLast {
        copy {
            from 'target/kernel-SNAPSHOT-standalone.jar'
            into '../server/lib'
        }
    }
}

// As of now, this has to be run MANUALLY if the kernel changed.
task build {
    dependsOn 'buildServer', 'buildClient'
}

task clean(type: Exec) {
    if (org.gradle.internal.os.OperatingSystem.current().isWindows()) {
        commandLine 'cmd', '/c', 'lein.bat', 'clean'
    } else {
        commandLine 'bash', 'lein', 'clean'
    }
    doLast {
        delete '../server/lib/kernel-SNAPSHOT-standalone.jar'
        delete '../client/src/modeling/_kernel.js'
        delete '../build/kernel-documentation'
    }
}