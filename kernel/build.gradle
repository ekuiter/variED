task uberjar(type:Exec) {
    if (org.gradle.internal.os.OperatingSystem.current().isWindows()) {
        commandLine 'lein.bat', 'uberjar'
    } else {
        commandLine 'bash', 'lein', 'uberjar'
    }
}

task check(type:Exec) {
    if (org.gradle.internal.os.OperatingSystem.current().isWindows()) {
        commandLine 'lein.bat', 'test'
    } else {
        commandLine 'bash', 'lein', 'test'
    }
}

task doc(type:Exec) {
    if (org.gradle.internal.os.OperatingSystem.current().isWindows()) {
        commandLine 'lein.bat', 'codox'
    } else {
        commandLine 'bash', 'lein', 'codox'
    }
}

// As of now, this has to be run MANUALLY if the kernel changed.
task build {
    dependsOn 'uberjar'
    doLast {
        copy {
            from 'target/kernel-SNAPSHOT-standalone.jar'
            into '../server/lib'
        }
    }
}

task clean(type:Exec) {
    if (org.gradle.internal.os.OperatingSystem.current().isWindows()) {
        commandLine 'lein.bat', 'clean'
    } else {
        commandLine 'bash', 'lein', 'clean'
    }
    doLast {
        delete '../server/lib/kernel-SNAPSHOT-standalone.jar'
        delete '../build/kernel-documentation'
    }
}